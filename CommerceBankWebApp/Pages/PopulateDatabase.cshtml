@page
@using CommerceBankWebApp.Models;
@model CommerceBankWebApp.Pages.PopulateDatabaseModel
@{
    Layout = "/Views/Shared/_Layout.cshtml";
}

@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<form method="post" enctype="multipart/form-data">
    <input type="file" asp-for="Upload" />
    <input type="submit" />
</form>

<table class="table">
    <tr>
        <td>Account Type</td>
        <td>Account #</td>
        <td>Date</td>
        <td>Balance</td>
        <td>Is Credit</td>
        <td>Amount</td>
        <td>Description</td>
    </tr>
    @foreach (BankAccount account in Model.BankAccounts)
    {
        double balance = 0.0;
        foreach (Transaction transaction in account.Transactions)
        {
            if (transaction.IsCredit) balance += transaction.Amount;
            else balance -= transaction.Amount;

            <tr>
                <td>@account.AccountType</td>
                <td>@account.AccountNumber</td>
                <td>@transaction.ProcessingDate.ToShortDateString()</td>

                @if (balance < 0)
                {
                    <td class="text-danger">$@balance.ToString("0.00")</td>
                }
                else
                {
                    <td>$@balance.ToString("0.00")</td>
                }
                @if (transaction.IsCredit)
                {
                    <td class="text-success">CR</td>
                    <td class="text-success">$@transaction.Amount.ToString("0.00")</td>
                }
                else
                {
                    <td class="text-danger">DR</td>
                    <td>$@transaction.Amount.ToString("0.00")</td>
                }

                <td>@transaction.Description</td>
            </tr>
        }
    }
</table>